<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>内容管理后台</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <script>
    // 告诉 CMS 我们将手动初始化
    window.CMS_MANUAL_INIT = true;

    // ** 最终的正确配置 **
    // 我们在这里定义配置, 稍后在脚本加载后使用它
    const cmsConfig = {
      locale: 'zh_Hans', // 设置界面为简体中文
      backend: {
        name: "github",
        repo: "yeeun4028/theme-next-docs", // 您的仓库
        branch: "master", // 您的生产分支
        auth_type: "oauth", // 使用 OAuth 流程
        base_url: "https://api.decapcms.org", // 使用 Decap 的免费认证服务器

        // 您的 GitHub Client ID (来自 image_2213c5.jpg 截图)
        client_id: "Ov23Li2QWKBRT7qr7iwr", 
      },
      media_folder: "source/images/uploads", // 媒体（图片）上传后存放的路径
      public_folder: "/images/uploads", // 媒体（图片）在网站上的访问路径

      collections: [
        {
          name: "posts",
          label: "文章",
          folder: "source/_posts",
          create: true,
          slug: "{{year}}-{{month}}-{{day}}-{{slug}}",
          extension: "md",
          fields: [
            { label: "标题", name: "title", widget: "string" },
            { label: "发布日期", name: "date", widget: "datetime" },
            { label: "标签", name: "tags", widget: "list", optional: true },
            { label: "分类", name: "categories", widget: "list", optional: true },
            { label: "正文", name: "body", widget: "markdown" },
          ],
        },
      ],
    };

    // --- 脚本加载和初始化 ---

    // 创建 script 标签
    const script = document.createElement("script");
    script.src = "https://cdn.jsdelivr.net/npm/decap-cms-app@^3.0.0/dist/decap-cms-app.js";

    // 脚本加载成功后执行
    script.onload = function() {
      // 脚本加载后, window.initCMS 才可用
      // 使用我们上面定义的配置来初始化 CMS
      window.initCMS({ config: cmsConfig });
    };

    // 脚本加载失败后执行
    script.onerror = function() {
      console.error("加载 Decap CMS 脚本失败。");
      document.body.innerHTML = "加载 Decap CMS 脚本失败。请检查网络或控制台。";
    };

    // 将脚本添加到 head 中, 开始加载
    document.head.appendChild(script);

  </script>
</body>
</html>
